!function(a){"use strict";function h(b){var c=b.selector;b.each(function(){var b="fancyInput",c=a('<div><b class="caret">&#8203;</b></div>');"TEXTAREA"==this.tagName&&(b+=" textarea"),a(this.parentNode).append(c).addClass(b),this.value&&e.fillText(this.value,this),this.placeholder&&(c.attr("data-placeholder",this.placeholder),this.value||c.addClass("empty"))}),a(document).off(".fi",c).on("input.fi",c,e.input).on("keypress.fi",c,e.keypress).on("keyup.fi select.fi mouseup.fi cut.fi paste.fi blur.fi",c,e.allEvents).on("mousedown.fi mouseup.fi keydown.fi",c,f.set).on("keydown.fi",c,e.keydown)}var d,b=!!window.ActiveXObject,c="webkitRequestAnimationFrame"in window;a.fn.fancyInput=function(){return(!b||"ontouchstart"in document.documentElement)&&h(this),this};var e={classToggler:"state1",keypress:function(a){var b=String.fromCharCode(a.charCode),c=this.nextElementSibling,d=this.selectionEnd,f="TEXTAREA"==this.tagName&&13==a.keyCode;if(this.selectionEnd-this.selectionStart>0&&a.charCode&&!a.metaKey&&!a.ctrlKey){var h=[this.selectionStart,this.selectionEnd];d=this.selectionStart,"rtl"==g.lastDir&&(h=[this.value.length-this.selectionEnd,this.value.length-this.selectionStart+1]),e.removeChars(c,h)}if(a.charCode&&!a.metaKey&&!a.ctrlKey||f){var i=g.check(b);("rtl"==i||""==i&&"rtl"==g.lastDir)&&(d=this.value.length-this.selectionStart),f&&(b=""),e.maskPassword(this),e.writer(b,this,d)}},input:function(){e.textLength=this.value.length,e.inputResize(this)},maskPassword:function(b){"password"==b.type&&a(b.nextElementSibling).find("span").each(function(){this.innerHTML=""})},setCaretHeight:function(b){var c=a(b.nextElementSibling);return c.find("span").length?(d=c.find("span")[0].clientHeight,c.find("b").height(d),void 0):!1},writer:function(b,c,d){var e=a(c.nextElementSibling).children().not("b"),f=document.createElement("span");if(c.maxLength>0&&e.length>c.maxLength)return this;if(" "==b&&(b="&nbsp;"),b?(f.innerHTML=b,this.classToggler="state2"==this.classToggler?"state1":"state2",f.className=this.classToggler):f=document.createElement("br"),e.length)if(0==d)a(c.nextElementSibling).prepend(f);else{var g=e.eq(--d);g.after(f)}else c.nextElementSibling.appendChild(f);return b&&setTimeout(function(){f.removeAttribute("class")},20),this},clear:function(b){var c=a(b.parentNode).find(".caret");a(b).html(c)},fillText:function(a,b){var d,c=b.nextElementSibling,f=document.createDocumentFragment();e.clear(b.nextElementSibling),setTimeout(function(){for(var b=a.length,e=0;b>e;e++){var g="span";"\n"==a[e]&&(g="br"),d=document.createElement(g),d.innerHTML=" "==a[e]?"&nbsp;":a[e],f.appendChild(d)}c.appendChild(f)},0)},removeChars:function(b,d){var g,e=a(b).children().not("b").not(".deleted");a(b).find("b"),d[0]==d[1]&&d[0]--,g=e.slice(d[0],d[1]),1==d[1]-d[0]?(g.css("position","absolute"),c&&g[0].offsetLeft,g.addClass("deleted"),setTimeout(function(){g.remove()},140)):g.remove()},inputResize:function(b){if("TEXTAREA"==b.tagName&&setTimeout(function(){b.style.top="-999px";var c=b.parentNode.scrollHeight;a(b).outerHeight()<b.parentNode.scrollHeight&&(c+=10),b.style.height=c+"px",b.style.top="0",setTimeout(function(){b.scrollTop=0,b.parentNode.scrollTop=9999},50)},0),"INPUT"==b.tagName&&"text"==b.type){b.style.width=0;var c=b.parentNode.scrollWidth;b.parentNode.scrollWidth>b.parentNode.clientWidth&&(c+=20),b.style.width=c+"px"}},keydown:function(a){var c=(String.fromCharCode(a.charCode),this.nextElementSibling),f=(this.selectionEnd,(a.metaKey||a.ctrlKey)&&90==a.keyCode||a.altKey&&8==a.keyCode),h=(a.metaKey||a.ctrlKey)&&89==a.keyCode,i=(a.metaKey||a.ctrlKey)&&65==a.keyCode,j=this.selectionEnd==this.selectionStart&&this.selectionEnd==this.value.length,k=46==a.keyCode&&!j;if(e.setCaret(this),i)return!0;if(f||h)return setTimeout(function(){e.fillText(a.target.value,a.target)},50),!0;if(8==a.keyCode||k){var l=[this.selectionStart,this.selectionEnd];"rtl"==g.lastDir&&(l=[this.value.length-this.selectionEnd,this.value.length-this.selectionStart+1]),k&&this.selectionEnd==this.selectionStart&&this.selectionEnd<this.value.length?(l[0]+=1,l[1]+=1,e.removeChars(c,l)):setTimeout(function(){(a.metaKey||a.ctrlKey)&&(l=[a.target.selectionStart,l[0]]),e.removeChars(c,l)},0)}return 0==this.selectionStart&&(this.parentNode.scrollLeft=0),!0},allEvents:function(a){e.setCaret(this),"paste"==a.type&&setTimeout(function(){e.fillText(a.target.value,a.target),e.inputResize(a.target)},20),"cut"==a.type&&e.removeChars(this.nextElementSibling,[this.selectionStart,this.selectionEnd]),(!a.keyCode||a.keyCode<50)&&e.maskPassword(this),d||setTimeout(function(){e.setCaretHeight(a.target)},150),this.selectionStart==this.value.length&&(this.parentNode.scrollLeft=999999),this.nextElementSibling.className=this.value?"":"empty"},setCaret:function(b){var c=a(b.parentNode).find(".caret"),d=a(b.nextElementSibling).children().not("b"),f=d.not(".deleted"),h=e.getCaretPosition(b);"rtl"==g.lastDir&&(h=b.value.length-h);var i=f.eq(h);h==b.value.length?c.appendTo(b.nextElementSibling):c.insertBefore(i)},getCaretPosition:function(a){var b,c=f.direction||"right";return(a.selectionStart||"0"==a.selectionStart)&&(b="left"==c?a.selectionStart:a.selectionEnd),b||0}},f={direction:null,lastOffset:null,set:function(a){var b;a.shiftKey&&37==a.keyCode?b="left":a.shiftKey&&39==a.keyCode&&(b="right"),"mousedown"==a.type?f.lastOffset=a.clientX:"mouseup"==a.type&&(b=a.clientX<f.lastOffset?"left":"right"),f.direction=b}},g={lastDir:null,check:function(a){var b="A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff",c="\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc",d=new RegExp("^[^"+c+"]*["+b+"]"),e=new RegExp("^[^"+b+"]*["+c+"]"),f=e.test(a)?"rtl":d.test(a)?"ltr":"";return f&&(this.lastDir=f),f}};window.fancyInput=e}(window.jQuery);